<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balancete de Execução Financeira — Sistema Orçamental</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Google Material Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container header-top">
            <div class="header-brand">
                <span class="material-icons header-icon">account_balance</span>
                <div class="header-text">
                    <h1>Balancete de Execução Financeira</h1>
                    <p class="header-subtitle">Agosto 2024 · Relatório Mensal</p>
                </div>
            </div>
            <div class="header-actions">
                <button id="exportBtn" class="btn btn-secondary">
                    <span class="material-icons">download</span>
                    Exportar CSV
                </button>
                <button id="printBtn" class="btn btn-secondary">
                    <span class="material-icons">print</span>
                    Imprimir
                </button>
            </div>
        </div>
        <div class="container header-search">
            <section class="search-section">
                <div class="search-container">
                    <span class="material-icons search-icon">search</span>
                    <input type="text" id="searchInput" placeholder="Pesquisar por Designação Orçamental ou Classificação..." class="search-input">
                    <button id="clearSearchBtn" class="btn btn-clear">
                        <span class="material-icons">close</span>
                        Limpar
                    </button>
                </div>
                <div id="searchResults" class="search-results" style="display: none;"></div>
            </section>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Dashboard Cards -->
            <section class="dashboard">
                <div class="cards-grid">
                    <div class="card card-dotacao">
                        <div class="card-header">
                            <div class="card-icon">
                                <span class="material-icons">account_balance_wallet</span>
                            </div>
                            <h3>Dotação Total</h3>
                        </div>
                        <span id="totalDotacao" class="card-value">0,00 MTn</span>
                        <div class="card-footer">
                            <span class="card-label">Orçamento disponível</span>
                        </div>
                    </div>
                    <div class="card card-gasto">
                        <div class="card-header">
                            <div class="card-icon">
                                <span class="material-icons">payments</span>
                            </div>
                            <h3>Gasto Total</h3>
                        </div>
                        <span id="totalGasto" class="card-value">0,00 MTn</span>
                        <div class="card-footer">
                            <span class="card-label">Despesas realizadas</span>
                        </div>
                    </div>
                    <div class="card card-saldo">
                        <div class="card-header">
                            <div class="card-icon">
                                <span class="material-icons">savings</span>
                            </div>
                            <h3>Saldo Livre</h3>
                        </div>
                        <span id="totalSaldo" class="card-value">0,00 MTn</span>
                        <div class="card-footer">
                            <span class="card-label">Disponível para uso</span>
                        </div>
                    </div>
                    <div class="card card-execucao">
                        <div class="card-header">
                            <div class="card-icon">
                                <span class="material-icons">analytics</span>
                            </div>
                            <h3>Execução</h3>
                        </div>
                        <span id="execucaoPercent" class="card-value">0%</span>
                        <div class="card-footer">
                            <span class="card-label">Percentual executado</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Balancete Table -->
            <section class="balancete-section">
                <div class="section-header">
                    <div class="section-title">
                        <span class="material-icons section-icon">table_chart</span>
                        <h2>Balancete de Execução Financeira</h2>
                    </div>
                    <div class="section-actions">
                        <button id="toggleAllBtn" class="btn btn-secondary btn-sm">
                            <span class="material-icons">unfold_more</span>
                            Expandir Todas
                        </button>
                        <span id="rubricasCount" class="section-badge">Carregando...</span>
                    </div>
                </div>
                <div class="table-container">
                    <table id="balanceteTable" class="data-table clickable-table">
                        <thead>
                            <tr>
                                <th data-sort="designacao">
                                    Designação Orçamental 
                                    <span class="material-icons sort-icon">unfold_more</span>
                                </th>
                                <th data-sort="classificacao">
                                    Classificação Orçamental 
                                    <span class="material-icons sort-icon">unfold_more</span>
                                </th>
                                <th data-sort="dotacao" class="text-right">
                                    Dotação Disponível 
                                    <span class="material-icons sort-icon">unfold_more</span>
                                </th>
                                <th data-sort="liquidacao_anterior" class="text-right">
                                    Liquidação até ao mês anterior 
                                    <span class="material-icons sort-icon">unfold_more</span>
                                </th>
                                <th data-sort="durante_mes" class="text-right">
                                    Durante o mês 
                                    <span class="material-icons sort-icon">unfold_more</span>
                                </th>
                                <th data-sort="gasto_total" class="text-right">
                                    Gasto até ao mês 
                                    <span class="material-icons sort-icon">unfold_more</span>
                                </th>
                                <th data-sort="saldo_livre" class="text-right">
                                    Saldo Livre 
                                    <span class="material-icons sort-icon">unfold_more</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="balanceteTableBody">
                            <!-- Dados serão carregados via JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="pagination">
                    <button id="prevPage" class="btn btn-pagination">
                        <span class="material-icons">chevron_left</span>
                        Anterior
                    </button>
                    <span id="pageInfo" class="page-info">Página 1 de 1</span>
                    <button id="nextPage" class="btn btn-pagination">
                        Próxima
                        <span class="material-icons">chevron_right</span>
                    </button>
                </div>
            </section>

            <!-- Relação Intercalar Modal -->
            <div id="relationModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title-container">
                            <span class="material-icons modal-icon">description</span>
                            <h2 id="modalTitle">Relação Intercalar de Despesas</h2>
                        </div>
                        <div class="modal-actions">
                            <button id="exportDetailsBtn" class="btn btn-secondary">
                                <span class="material-icons">file_download</span>
                                Exportar
                            </button>
                            <button id="closeModal" class="close-btn">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <!-- Rubrica Details -->
                        <div class="relation-header">
                            <div class="relation-title">
                                <h3 id="modalDesignacao">Designação da Rubrica</h3>
                                <p class="relation-subtitle">
                                    Classificação: <span id="modalCodigo">-</span> | Exercício: 2024
                                </p>
                            </div>
                            <div class="relation-summary">
                                <div class="summary-item">
                                    <label>Dotacao:</label>
                                    <span id="modalDotacao">-</span>
                                </div>
                                <div class="summary-item">
                                    <label>Gasto Total:</label>
                                    <span id="modalGasto">-</span>
                                </div>
                                <div class="summary-item">
                                    <label>Saldo Livre:</label>
                                    <span id="modalSaldo">-</span>
                                </div>
                                <div class="summary-item">
                                    <label>Execução:</label>
                                    <span id="modalExecucao">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Despesas Table -->
                        <div class="modal-section-header">
                            <span class="material-icons">receipt_long</span>
                            <h4>Despesas Associadas</h4>
                        </div>
                        <div class="table-container">
                            <table id="relationTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th data-sort="fornecedor">
                                            Fornecedor 
                                            <span class="material-icons sort-icon-small">unfold_more</span>
                                        </th>
                                        <th data-sort="requisicao">
                                            Requisição 
                                            <span class="material-icons sort-icon-small">unfold_more</span>
                                        </th>
                                        <th data-sort="justificativo">
                                            Justificativo 
                                            <span class="material-icons sort-icon-small">unfold_more</span>
                                        </th>
                                        <th data-sort="ordem_pagamento">
                                            Ordem de Pagamento 
                                            <span class="material-icons sort-icon-small">unfold_more</span>
                                        </th>
                                        <th data-sort="valor" class="text-right">
                                            Importância 
                                            <span class="material-icons sort-icon-small">unfold_more</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="relationTableBody">
                                    <!-- Dados serão carregados via JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Totals and Validation -->
                        <div class="totals-section">
                            <div class="total-row">
                                <strong>Total Geral: <span id="totalDespesas">0,00 €</span></strong>
                            </div>
                            <div class="execution-info">
                                <span id="executionText">Percentagem de execução calculada automaticamente</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="app.js"></script>
</body>
</html>
